(self.globalSSILoad=self.globalSSILoad||[]).push([[737],{35155:(e,t,o)=>{"use strict";o.d(t,{Gp:()=>b,dv:()=>T,fv:()=>m,h$:()=>S,t8:()=>w,vv:()=>y});var n=o(26660),r=o.n(n),i=o(87017),a=o(45810),s=o.n(a),c=o(35155);function l(e,t,o,n,r,i,a){try{var s=e[i](a),c=s.value}catch(e){return void o(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function u(e){return function(){var t=this,o=arguments;return new Promise((function(n,r){var i=e.apply(t,o);function a(e){l(i,n,r,a,s,"next",e)}function s(e){l(i,n,r,a,s,"throw",e)}a(void 0)}))}}const d="/api/v1/users/",p="/ajax/create_account.php";let f;const g=()=>{f||(f=r().create({timeout:6e4,headers:{"Content-Type":"application/json;charset=utf-8"}}))},h=e=>{const t=`[Login/Registration/Forgot Pwd] - ${e.message}`;var o;"undefined"!=typeof window&&(null==(o=window.rollbar)||o.error(t));console.error(t)},v=u((function*(e){return g(),f.get(e)})),y=u((function*(e,t){return g(),f.post(e,s().stringify(t),{headers:{"content-type":"application/x-www-form-urlencoded"}})})),m=u((function*(e,t){const o=t?p:d;let n="Unknown error occurred";try{return(yield c.vv(o,e)).data||{}}catch(e){if(e.isAxiosError){const t=e.response;if(t.status<200||t.status>=300){const{error:e,validation:o}=t.data||{};e?Array.isArray(e)?(n=e.join(", "),console.error(n+" [0]")):e.message?(n=e.message,console.error(n+" [1]")):Array.isArray(e.validation)&&(n=e.validation.join(", "),console.error(n+" [2]")):Array.isArray(o)?(n=o.join(", "),console.error(n+" [3]")):console.error(t)}else console.error(n+" [4]")}else h(e),n=e,console.error(n+" [5]");throw n}})),w=(e,t)=>(0,i.useQuery)(["fetchSchools",e],(()=>v(`/api/v1/schools/?q=${e}&limit=20&includeSchoolsWithNoDocuments=true`).then((e=>e.data))),{enabled:t}),b=(e,t,o)=>(0,i.useQuery)(["fetchCourses",e],(()=>v(`/api/v1/schools/${t}/courses/?isVerifiedSchool=0&limit=20&q=${e}`).then((e=>e.data))),{enabled:o}),T=(e,t,o)=>(0,i.useQuery)(["fetchDepartment",e],(()=>v(`/api/v1/schools/${t}/departments/?q=${e}`).then((e=>e.data))),{enabled:o}),S=e=>(0,i.useQuery)(["fetchUserSchool"],(()=>v("/api/v1/users/school-details/").then((e=>e.data))),{enabled:e})},84550:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>C});var n=o(41486),r=o.n(n),i=o(80917),a=o(35155),s=o(26660),c=o.n(s),l=o(45810),u=o.n(l);function d(e,t,o,n,r,i,a){try{var s=e[i](a),c=s.value}catch(e){return void o(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function p(e){return function(){var t=this,o=arguments;return new Promise((function(n,r){var i=e.apply(t,o);function a(e){d(i,n,r,a,s,"next",e)}function s(e){d(i,n,r,a,s,"throw",e)}a(void 0)}))}}const f="/api/v1/users/";let g;const h=p((function*(e,t){return g||(g=c().create({timeout:6e4,headers:{"Content-Type":"application/json;charset=utf-8"}})),g.post(e,u().stringify(t),{headers:{"content-type":"application/x-www-form-urlencoded"}})})),v=e=>{if(e.isAxiosError){const t=e.response;let o="Unknown error occurred";if((null==t?void 0:t.status)<200||(null==t?void 0:t.status)>=300){const{error:e}=t.data||{};throw Array.isArray(null==e?void 0:e.validation)&&(o=e.validation.join(", ")),o}throw o}reportError(e)},y=p((function*(e){const t=f;try{return(yield h(t,e)).data||{}}catch(e){v(e)}}));function m(e,t,o,n,r,i,a){try{var s=e[i](a),c=s.value}catch(e){return void o(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function w(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var b,T,S=(b=function(e){var t,o,n,r,i,s,c,l,u,d,p,f,g,h,v;return w(this,(function(m){switch(m.label){case 0:t=e.credential,o=e.isSignUp,n=e.onSuccess,r=e.onFailure,i=e.rememberMeChecked,s=e.formattedMessage,c=e.googleSSOWidget,l=e.isMdsUser,d=(w=t,b=w.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(atob(b))).email,p=null,f=l?y:a.fv,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,f({externalAuthenticator:"google",googleSSOWidget:c,credential:t,email:d,reg_user_type:"student",schoolIdString:"",premier_access_code:"",remember_me:i?"1":"0"})];case 2:if((g=m.sent())&&(p=l?g.login_response.login_success:"string"==typeof g.userDetails?JSON.parse(g.userDetails):g.userDetails),!o&&"object"!=typeof(null==p?void 0:p.userProperties))throw new Error(s);return[3,4];case 3:return h=m.sent(),r(h),[2];case 4:return v=Boolean(null==p||null===(u=p.userProperties)||void 0===u?void 0:u.School)||!!l,n({data:{email:d,idToken:t},username:d,hasExistingAccount:v,login_success:p}),[2]}var w,b}))},T=function(){var e=this,t=arguments;return new Promise((function(o,n){var r=b.apply(e,t);function i(e){m(r,o,n,i,a,"next",e)}function a(e){m(r,o,n,i,a,"throw",e)}i(void 0)}))},function(e){return T.apply(this,arguments)});const O=S;var G=o(35827);const E="/register/";var A;!function(e){e.GOOGLE="google",e.GOOGLE_ONE_TAP="google_one_tap",e.FACEBOOK="facebook",e.APPLE="apple",e.EMAIL="email"}(A||(A={}));class L{static removeLoginAuthTypeFromUrl(){const e=new URLSearchParams(window.location.search);e.has("loginAuthType")&&(e.delete("loginAuthType"),window.history.replaceState({},"",`${window.location.pathname}?${e.toString()}`))}static redirectToRegisterPage(e){window.location.href=E+"?"+((e,t)=>{const o=new URL(e),n=new URLSearchParams(o.search);return Object.entries(t).forEach((([e,t])=>{n.append(e,t)})),n.toString()})(window.location.href,e)}static isGoogleOneTapLoginType(e){return e===A.GOOGLE_ONE_TAP}static isGoogleButtonLoginType(e){return e===A.GOOGLE}static isGoogleLoginType(e){return this.isGoogleButtonLoginType(e)||this.isGoogleOneTapLoginType(e)}static setGoogleOneTapLoginType(){return A.GOOGLE_ONE_TAP}static setGoogleLoginType(){return A.GOOGLE}static setGoogleOneTapSocialData(e,t){return{email:e,idToken:t,loginAuthType:this.setGoogleOneTapLoginType()}}static setGoogleSocialData(e,t){return{email:e,idToken:t,loginAuthType:this.setGoogleLoginType()}}}function _(e,t,o,n,r,i,a){try{var s=e[i](a),c=s.value}catch(e){return void o(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function k(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var P="has_seen_one_tap",x=function(e){var t=e.hasExistingAccount,o=e.data,n=o.idToken,r=o.email;if(t)((e,t)=>{G.AmplitudeService.setUserId(null==e?void 0:e.userId),G.AmplitudeService.setUserProperties(null==e?void 0:e.userProperties),G.AmplitudeService.triggerGTMCustomEvent({event:"login-success"}),void 0!==window.ga&&window.ga("send","event","Registration","Logged In");const o=window.gtag;void 0!==o&&o("event","login",{method:t}),G.AmplitudeService.triggerGTMCustomEvent({event:"User Tracking Event",user_tracking_properties:{eventName:"Login",properties:{"Login Type":t}}})})({userId:e.login_success.user_id,userProperties:e.login_success.userProperties},"Google One Tap"),location.reload();else if(location.pathname!==E){var i=L.setGoogleOneTapSocialData(r,n);L.redirectToRegisterPage(i)}},U=function(e){console.error("Google One Tap login failure: %o",e),G.AmplitudeService.trackEvent("Google One Tap Sign In Error",{error:e})},R=function(e){var t=function(e){return s.apply(this,arguments)},o=e.clientId,r=e.isMdsUser,a=void 0!==r&&r;function s(){return s=function(e){return function(){var t=this,o=arguments;return new Promise((function(n,r){var i=e.apply(t,o);function a(e){_(i,n,r,a,s,"next",e)}function s(e){_(i,n,r,a,s,"throw",e)}a(void 0)}))}}((function(e){var t;return k(this,(function(o){return t=e.credential,O({credential:t,isSignUp:!0,onSuccess:x,onFailure:U,rememberMeChecked:!1,formattedMessage:"Could not login to Course Hero with Google One Tap credentials",googleSSOWidget:"onetap",isMdsUser:a}),[2]}))})),s.apply(this,arguments)}return(0,n.useEffect)((function(){var e=new i.A;if(!e.get(P)){var n=document.createElement("script");return n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n.addEventListener("load",(function(){window.google.accounts.id.initialize({client_id:o,callback:t,cancel_on_tap_outside:!1}),window.google.accounts.id.prompt((function(e){e&&G.AmplitudeService.trackEvent("Google OneTap",{momentType:e.getMomentType(),notDisplayedReason:e.getNotDisplayedReason()||"none",skippedReason:e.getSkippedReason()||"none",dismissedReason:e.getDismissedReason()||"none"})}));var n=new MutationObserver((function(t){t.forEach((function(t){"childList"===t.type&&(document.querySelector('iframe[src^="'.concat("https://accounts.google.com/gsi/iframe/select",'"]'))&&(e.set(P,!0,{path:"/",maxAge:3600}),n.disconnect()))}))}));n.observe(document.body,{childList:!0,subtree:!0})})),n.addEventListener("error",(function(){console.error("Error loading Google One Tap script")})),document.body.appendChild(n),function(){document.body.removeChild(n)}}}),[o]),null};const C=e=>r().createElement(R,e)},86973:()=>{}}]);
//# sourceMappingURL=google-one-tap.996666c1f5f7b43c8110.js.map